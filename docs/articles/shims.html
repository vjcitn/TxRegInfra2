<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>shims in TxRegInfra2: dealing with heterogeneous annotation native to different genomic assay archives • TxRegInfra2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="shims in TxRegInfra2: dealing with heterogeneous annotation native to different genomic assay archives">
<meta property="og:description" content="TxRegInfra2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93043521-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93043521-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TxRegInfra2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/TxRegInfra2.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shims.html">shims in TxRegInfra2: dealing with heterogeneous annotation native to different genomic assay archives</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vjcitn/TxRegInfra2">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>shims in TxRegInfra2: dealing with heterogeneous annotation native to different genomic assay archives</h1>
                        <h4 class="author">Vincent J. Carey, stvjc at channing.harvard.edu</h4>
            
            <h4 class="date">December 25, 2020</h4>
      
      
      <div class="hidden name"><code>shims.Rmd</code></div>

    </div>

    
    
<pre><code>## Loading required package: RaggedExperiment</code></pre>
<pre><code>## Loading required package: GenomicRanges</code></pre>
<pre><code>## Loading required package: stats4</code></pre>
<pre><code>## Loading required package: BiocGenerics</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre><code>## 
## Attaching package: 'BiocGenerics'</code></pre>
<pre><code>## The following objects are masked from 'package:parallel':
## 
##     clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,
##     clusterExport, clusterMap, parApply, parCapply, parLapply,
##     parLapplyLB, parRapply, parSapply, parSapplyLB</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     IQR, mad, sd, var, xtabs</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     anyDuplicated, append, as.data.frame, basename, cbind, colnames,
##     dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,
##     grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,
##     order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,
##     rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,
##     union, unique, unsplit, which.max, which.min</code></pre>
<pre><code>## Loading required package: S4Vectors</code></pre>
<pre><code>## 
## Attaching package: 'S4Vectors'</code></pre>
<pre><code>## The following object is masked from 'package:base':
## 
##     expand.grid</code></pre>
<pre><code>## Loading required package: IRanges</code></pre>
<pre><code>## Loading required package: GenomeInfoDb</code></pre>
<pre><code>## Loading required package: mongolite</code></pre>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>In home maintenance, shims are little wedges of wood that you stick into wobbly entities to make them more stable.</p>
<p>We need things like this to deal with diverse data resources in genomics. Here’s an example of the problem:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cm</span> <span class="op">=</span> <span class="fu">TxRegInfra2</span><span class="fu">:::</span><span class="fu">basicCfieldsMap</span><span class="op">(</span><span class="op">)</span>
<span class="va">cmdf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cmdf</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span>
<span class="va">cmdf</span></code></pre></div>
<pre><code>##          eQTL    FP         HS
## chrom     chr   chr      chrom
## start snp_pos start chromStart
## end   snp_pos   end   chromEnd</code></pre>
<p>The rownames of this data frame are target annotation terms for features of GRanges: chrom, start, end. The columns are different assay types. Entry i,j is the notation for feature i on assay type j. Thus for eQTL data the start and end can be determined from the source attribute ‘snp_pos’, while for footprints (FP) the footprint end is denoted ‘end’ and for hotspots (HS) the footprint end is denoted ‘chromEnd’.</p>
<p>In order to leave data in its original state but simplify downstream integration, we use shims like <code>basicCfieldsMap</code> to map attribute names to a common vocabulary.</p>
</div>
<div id="application-to-raggedmongoexpt-instances" class="section level1">
<h1 class="hasAnchor">
<a href="#application-to-raggedmongoexpt-instances" class="anchor"></a>Application to RaggedMongoExpt instances</h1>
<p>We use <code>RaggedMongoExpt</code> instances to work with contents of a remote MongoDB that holds large volumes of genomic annotation.</p>
<div id="construction" class="section level2">
<h2 class="hasAnchor">
<a href="#construction" class="anchor"></a>Construction</h2>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">con1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mongolite/man/mongo.html">mongo</a></span><span class="op">(</span>url<span class="op">=</span><span class="fu"><a href="../reference/URL_txregLocal.html">URL_txregLocal</a></span><span class="op">(</span><span class="op">)</span>, db<span class="op">=</span><span class="st">"txregnet"</span><span class="op">)</span>
<span class="va">cd</span> <span class="op">=</span> <span class="fu">TxRegInfra2</span><span class="fu">::</span><span class="va"><a href="../reference/basicColData.tiny.html">basicColData.tiny</a></span>
<span class="va">rme0</span> <span class="op">=</span> <span class="fu"><a href="../reference/RaggedMongoExpt.html">RaggedMongoExpt</a></span><span class="op">(</span><span class="va">con1</span>, colData<span class="op">=</span><span class="va">cd</span><span class="op">)</span>
<span class="va">rme0</span></code></pre></div>
<pre><code>## class: RaggedMongoExpt 
## dim: 5 5 
## assays(0):
## rownames: NULL
## colnames(5): ENCFF001WBZ_hg19_HS fLung_DS14724_hg19_FP
##   fPlacenta_DS20346_hg19_FP Lung_allpairs_v7_eQTL M5946_1_02_tf
## colData names(6): base type ... type mid</code></pre>
<p>Here <code>rme0</code> holds a reference to a MongoDB database, coordinated with the <code>colData</code> component. (The package includes a unit test for correspondence between collection names in the txregnet database and the colData element names.)</p>
</div>
<div id="basic-motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-motivation" class="anchor"></a>Basic motivation</h2>
<p>We’ll step back for a moment to give a sense of basic motivations. We want to use MongoDB to manage data about eQTL, DnaseI hypersensitive regions and so forth, without curating the related file contents. Here’s an illustration of the basic functionality for eQTL:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mycon</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mongolite/man/mongo.html">mongo</a></span><span class="op">(</span>db<span class="op">=</span><span class="st">"txregnet"</span>, 
   url<span class="op">=</span><span class="fu"><a href="../reference/URL_txregLocal.html">URL_txregLocal</a></span><span class="op">(</span><span class="op">)</span>,   
   collection<span class="op">=</span><span class="st">"Lung_allpairs_v7_eQTL"</span><span class="op">)</span>
<span class="va">mycon</span><span class="op">$</span><span class="fu">find</span><span class="op">(</span>q<span class="op">=</span><span class="fu">rjson</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rjson/man/toJSON.html">toJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>chr<span class="op">=</span><span class="fl">17</span><span class="op">)</span><span class="op">)</span>, limit<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>##             gene_id       variant_id tss_distance ma_samples ma_count      maf
## 1 ENSG00000272636.1 17_36551_T_C_b37         5124        286      367 0.479112
## 2 ENSG00000272636.1 17_37559_G_C_b37         6132        251      309 0.404450
##   pval_nominal    slope  slope_se     qvalue chr snp_pos A1 A2 build
## 1  0.000892921 0.176774 0.0527027 0.06317724  17   36551  T  C   b37
## 2  0.000387538 0.195444 0.0544874 0.03292989  17   37559  G  C   b37</code></pre>
<p>We’ll need different <code>q</code> components for assays of different types, because the internal notation used for chromosomes differs between the assay types. Other aspects of diversified annotation can emerge, and the shim concept helps deliver to the user a more unified interface in the face of this diversity.</p>
</div>
<div id="the-sbov-function" class="section level2">
<h2 class="hasAnchor">
<a href="#the-sbov-function" class="anchor"></a>The <code>sbov</code> function</h2>
<p>At present, the main workhorse for retrieving assay results from RaggedMongoExpt instances is <code>sbov</code>, which is an approach to a <code>subsetByOverlaps</code> functionality. We’ll illustrate this with extractions from lung-related eQTL, Dnase hotspot, and digital genomic footprinting results.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lname_eqtl</span> <span class="op">=</span> <span class="st">"Lung_allpairs_v7_eQTL"</span>
<span class="va">lname_dhs</span> <span class="op">=</span> <span class="st">"ENCFF001WBZ_hg19_HS"</span> <span class="co"># see dnmeta</span>
<span class="va">lname_fp</span> <span class="op">=</span> <span class="st">"fLung_DS14724_hg19_FP"</span>
<span class="va">si17</span> <span class="op">=</span> <span class="fu">GenomeInfoDb</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/GenomeInfoDb/man/Seqinfo-class.html">Seqinfo</a></span><span class="op">(</span>genome<span class="op">=</span><span class="st">"hg19"</span><span class="op">)</span><span class="op">[</span><span class="st">"chr17"</span><span class="op">]</span>
<span class="va">si17n</span> <span class="op">=</span> <span class="va">si17</span>
<span class="fu">GenomeInfoDb</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/GenomeInfoDb/man/seqlevelsStyle.html">seqlevelsStyle</a></span><span class="op">(</span><span class="va">si17n</span><span class="op">)</span> <span class="op">=</span> <span class="st">"NCBI"</span>
<span class="va">s1</span> <span class="op">=</span> <span class="fu"><a href="../reference/sbov.html">sbov</a></span><span class="op">(</span><span class="va">rme0</span><span class="op">[</span>,<span class="va">lname_eqtl</span><span class="op">]</span>, <span class="fu">GRanges</span><span class="op">(</span><span class="st">"17"</span>, <span class="fu">IRanges</span><span class="op">(</span><span class="fl">38.06e6</span>, <span class="fl">38.15e6</span><span class="op">)</span>,
    seqinfo<span class="op">=</span><span class="va">si17n</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## .</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s2</span> <span class="op">=</span> <span class="fu"><a href="../reference/sbov.html">sbov</a></span><span class="op">(</span><span class="va">rme0</span><span class="op">[</span>,<span class="va">lname_dhs</span><span class="op">]</span>, <span class="fu">GRanges</span><span class="op">(</span><span class="st">"chr17"</span>, <span class="fu">IRanges</span><span class="op">(</span><span class="fl">38.06e6</span>, <span class="fl">38.15e6</span><span class="op">)</span>,
   seqinfo<span class="op">=</span><span class="va">si17</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## .</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s3</span> <span class="op">=</span> <span class="fu"><a href="../reference/sbov.html">sbov</a></span><span class="op">(</span><span class="va">rme0</span><span class="op">[</span>,<span class="va">lname_fp</span><span class="op">]</span>, <span class="fu">GRanges</span><span class="op">(</span><span class="st">"chr17"</span>, <span class="fu">IRanges</span><span class="op">(</span><span class="fl">38.06e6</span>, <span class="fl">38.15e6</span><span class="op">)</span>,
   seqinfo<span class="op">=</span><span class="va">si17</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## .</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">s1</span>,<span class="va">s2</span>,<span class="va">s3</span><span class="op">)</span>,<span class="va">length</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 693  10 107</code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu">mcols</span><span class="op">(</span><span class="va">s1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "gene_id"      "variant_id"   "tss_distance" "ma_samples"   "ma_count"    
##  [6] "maf"          "pval_nominal" "slope"        "slope_se"     "qvalue"      
## [11] "chr"          "snp_pos"      "A1"           "A2"           "build"       
## [16] "origin"</code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s3</span></code></pre></div>
<pre><code>## GRanges object with 107 ranges and 4 metadata columns:
##         seqnames            ranges strand |         chr          id      stat
##            &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt; &lt;character&gt; &lt;numeric&gt;
##     [1]    chr17 38083253-38083260      * |       chr17   id-454581  0.761905
##     [2]    chr17 38083323-38083335      * |       chr17   id-454582  0.944444
##     [3]    chr17 38083535-38083541      * |       chr17   id-454583  0.805556
##     [4]    chr17 38083577-38083590      * |       chr17   id-454584  0.943787
##     [5]    chr17 38083593-38083606      * |       chr17   id-454585  0.933258
##     ...      ...               ...    ... .         ...         ...       ...
##   [103]    chr17 38137063-38137085      * |       chr17   id-454683  0.415564
##   [104]    chr17 38137093-38137104      * |       chr17   id-454684  0.626329
##   [105]    chr17 38137126-38137132      * |       chr17   id-454685  0.599430
##   [106]    chr17 38137137-38137146      * |       chr17   id-454686  0.535317
##   [107]    chr17 38137194-38137201      * |       chr17   id-454687  0.606061
##                        origin
##                   &lt;character&gt;
##     [1] fLung_DS14724_hg19_FP
##     [2] fLung_DS14724_hg19_FP
##     [3] fLung_DS14724_hg19_FP
##     [4] fLung_DS14724_hg19_FP
##     [5] fLung_DS14724_hg19_FP
##     ...                   ...
##   [103] fLung_DS14724_hg19_FP
##   [104] fLung_DS14724_hg19_FP
##   [105] fLung_DS14724_hg19_FP
##   [106] fLung_DS14724_hg19_FP
##   [107] fLung_DS14724_hg19_FP
##   -------
##   seqinfo: 1 sequence from hg19 genome</code></pre>
<p>In principle we could avoid the <code>seqlevelsStyle</code> manipulation by checking assay type within <code>sbov</code>, but at the moment the user must shoulder this responsibility.</p>
<p>To see more about how to work with <code>sbov</code> outputs, check the main vignette.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by VJ Carey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
